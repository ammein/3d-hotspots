import { Meta } from '@storybook/addon-docs/blocks';
import LatexRenderer from '@/design-system/components/LatexRenderer';
import Headline from '@/components/Headline';
import Paragraph from '@/components/Body';
import Plot from '@/design-system/components/Plot';
import { Mermaid } from 'mdx-mermaid/Mermaid';
import CodeBlock from '@/design-system/components/CodeBlock';
import js_beautify from 'js-beautify';

<Meta title="Documentation/Maintainer/Contributing Guidelines" />

## Contribute Project

### Setup Project
This project is free to contribute but you need to have at least Git experience to contribute to this project.

First you need to clone the project:
<CodeBlock language='bash' copyToClipboard>
{`git clone https://gitlab.com/dsvideoteam/3d/3d-hotspots.git`}
</CodeBlock>

Then you need to create a new branch with the name of a new feature. Say you want to add `hotspot feature`, you can create a new branch like this:
<CodeBlock language='bash' copyToClipboard>
{`git checkout -b hotspot-feature`}
</CodeBlock>
> This will checkout to newly created branch. If you are not ready to checkout and simply wanted to just create a new branch, simply run `git branch hotspot-feature`

Now you are ready to do whatever you want on your newly created branch once successfully checking out to your desired new branch.

## Code Guidelines

### General Guidelines
* Follow a consistent **code style** throughout the project.
* Use **arrow functions** for all function expressions.

### File Structure
* Organize files by **type** rather than feature.
* Use **PascalCase** for component filenames (e.g., `MyComponent.js`).
* Use **camelCase** for other JavaScript files & Scenes (e.g., `utils.js`).

### Import Statements
* Use **absolute imports** for components and utilities. (e.g., `import Body from '@/components/Body.jsx'`). Refer to `jsconfig.json` and `vite.config.js` for module aliases.

### Components
* Use **functional components** and **hooks** instead of class components.
* Define components using **arrow functions**.

<CodeBlock language='jsx' copyToClipboard showLineNumbers>
{js_beautify.js(`const MyComponent = () => {
    return <div>Hello World</div>;
};`, { "e4x": true })}
</CodeBlock>

### State Management
* Use the **useState** and useEffect hooks for state management.
* Avoid using class-based state management.
<CodeBlock language='jsx' showLineNumbers>
{`const [count, setCount] = useState(0);

useEffect(() => {
  // Side effects here
}, []);`}
</CodeBlock>

### JSX Guidelines
* Use **self-closing tags** for elements without children.
* Keep JSX expressions on a single line if they fit within 80 characters.
* Use **template literals** for dynamic class names.
<CodeBlock language='jsx' showLineNumbers>
{`const className = \`button \${isActive ? 'active' : ''}\`;
return <button className={className}>Click Me</button>;`}
</CodeBlock>

### Theatre.js Guidelines
Say that your react component setup like this:
<CodeBlock language='jsx' showLineNumbers>
{js_beautify.js(`
const CustomComponent = (props) => {
  return (
    <p>{"Custom Component"}</p>
  )
}

return CustomComponent;
`, {
  "e4x": true,
})}
</CodeBlock>

Then simply import at the top of the file for Theatre Management HOC like this:
<CodeBlock language='jsx' showLineNumbers copyToClipboard>
{js_beautify.js(`
import { types } from '@theatre/core';
import withTheatreManagement from '@/components/hoc/TheatreManagement';`, {
  "e4x": true,
  "brace_style": "collapse,preserve-inline"
})}
</CodeBlock>

Then implement to the Custom Component's Functional Component into `withTheatreManagement`:
<CodeBlock language='jsx' showLineNumbers>
{js_beautify.js(`
import { types } from '@theatre/core';
import withTheatreManagement from '@/components/hoc/TheatreManagement';

const CustomComponent = (props) => {
  return (
    <p>{"Custom Component"}</p>
  )
}

const CustomComponentTheatreJS = withTheatreManagement(CustomComponent, 'Custom', {
  Text: {
    props: {
      text: types.string("Default String"),
    }
  }
})

return CustomComponentTheatreJS;
`, {
  "e4x": true,
  "brace_style": "collapse,preserve-inline"
})}
</CodeBlock>

You see that `withTheatreManagement` accepts 3 parameters. These are the parameters value type arrange in order:
<ol>
  <li className='list-decimal'>React Component</li>
  <li className='list-decimal'>[Sheet Name](https://www.theatrejs.com/docs/latest/manual/sheets) that executes as:</li>
   <CodeBlock language='js' showLineNumbers>
   {`// project is a Project created earlier through getProject
    const mySheet = project.sheet('Custom')`}
   </CodeBlock>
   <li className='list-decimal'>[Sheets Objects](https://www.theatrejs.com/docs/latest/manual/objects) & [Options](https://www.theatrejs.com/docs/latest/manual/objects#reconfiguring-existing-objects)</li>
   <CodeBlock language='js' showLineNumbers>
   {js_beautify.js(`{
    "<LayerName>": {
      props: {
        "<PropName>": types.number(0),
        // ...
      },
      options: {
        reconfigure: boolean // default: undefined
      }
    },
    r3f: boolean // default: true
   }`)}
   </CodeBlock>
   <blockquote>
   Anything key value that wrapped with `<...>` symbol is your own custom key name. `<LayerName>` will be grouped all the props in it. `<PropName>` is the [prop](https://www.theatrejs.com/docs/latest/manual/prop-types) of your `<LayerName>`. You can define whatever prop(s) in `LayerName`. As for `options`, you can refer here as per [documentation](https://www.theatrejs.com/docs/latest/manual/objects#reconfiguring-existing-objects). 
   </blockquote>
   <blockquote>
   `r3f` however, the theatrejs is designed for all `react-three-fiber` components by default. If your component is outside of [`Canvas`](https://r3f.docs.pmnd.rs/api/canvas) area (If your component is not bound to react-three-fiber component's children), you might want to set it to `false`.
   </blockquote>
</ol>

Then you can get the theatrejs prop's value like this:
<CodeBlock language='jsx' showLineNumbers>
{js_beautify.js(`
import { types } from '@theatre/core';
import withTheatreManagement from '@/components/hoc/TheatreManagement';

/**
 * Custom Component
 * @param {import('@/components/hoc/TheatreManagement').TheatreReturnValue} props
 * @returns
 */
const CustomComponent = (props) => {
  // Grab the TheatreJS Prop(s) here
  const { Text: TextTheatreJS } = props.theatre

  return (
    <>
      {/* Append to the p textContent */}
      <p>{TextTheatreJS.text}</p>
    </>
  )
}

const CustomComponentTheatreJS = withTheatreManagement(CustomComponent, 'Custom', {
  Text: {
    props: {
      text: types.string("Default String"),
    }
  }
})

return CustomComponentTheatreJS;
`, {
  "e4x": true,
  "brace_style": "collapse,preserve-inline"
})}
</CodeBlock>

Your Custom component will product output like this:
<CodeBlock language='html'>
{js_beautify.html(`
<p>Default String</p>
`)}
</CodeBlock>

### Styling
Strictly use **CSS Modules** only for specific tag classes. You can implement tailwindcss inside css using `@apply` key. If you created new module css, you must place the file inside `stylesheet/modules`
<CodeBlock language="bash" showLineNumbers>
{`./src
└── ./src/stylesheets
    └── ./src/stylesheets/modules`}
    </CodeBlock>

And inside css, you have to add `@reference` & `@source` to `theme.css` inside `stylesheets` folder. Here is for example:
<CodeBlock language='css' showLineNumbers copyToClipboard>
{`@source "../theme.css";
@reference "../theme.css";

.Canvas {
  @apply size-full mx-auto block;
}`}
</CodeBlock>

### Comments
* Use [**JSDoc**](https://jsdoc.app) for function documentation.
* Write meaningful comments for complex logic.

### Testing
* Write tests using **Storybook Test**, **Jest** and **React Testing Library**.
* Aim for at least **80% test coverage**.

### Version Control
* Commit often with **meaningful commit messages**.
* Use branches for new features and bug fixes.

### Push to Repo
Before you are going to push to your newly created branch repo. Make sure you check your code linter to run checks on your local project either the code is following guideline or not. Simply run command:
<CodeBlock language='bash' copyToClipboard>
{`yarn lint`}
</CodeBlock>
> If you have errors on the console output after running `yarn lint`, fix all the code for all those highlighted errors that were highlighted by eslint.

## Conclusion
Following these guidelines will help maintain a clean, efficient, and readable codebase. Remember to review and update these guidelines as necessary to adapt to project needs.